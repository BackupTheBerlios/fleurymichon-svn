\section{Vers un serveur fonctionnel}

Voilà, nous y sommes presque. Ce monde meilleur pour le flood qui avait emergé à la soutenance précédente est devenu en l'espace d'un mois beaucoup plus
fonctionnel qu'avant. En effet, les utilisateurs peuvent dores et déjà s'insulter à leur guise sur des canaux aux sujets inintéressants. Ils peuvent aussi
se doter de super-pouvoirs tels que le mode opérateur qui leur permet entre autre (et surtout gnark gnark!) de "kicker" les utilisateurs du canal. De plus,
de nombreux bugs ont été résolus et démystifiés.

\section{Corrections effectuées}

\subsection{Des sockets débogués}

À la première soutenance, des messages entre les clients et le serveur étaient souvent mis en attente en raison du caractère bloquant de l'appel à la fonction \textit{fgets()}. Ainsi, un client devait envoyer une autre commande au serveur, pour que le message en attente qui lui est destiné lui parvienne. Nous avons réussi à résoudre ce problème en lisant l'entrée du socket octet par octet, en vérifiant à chaque fois si des données sont prêtes à être reçues. Désormais, le serveur réagit instantanément aux commandes soumises par les clients : le protocole opère en temps réel.

\subsection{Du code plus propre}

Certaines sections du code du serveur nécessitent des traitements de listes particulièrement délicats. Nous avions utilisé des définitions de fonctions imbriquées dans d'autres. Nous savons que ce n'est pas du langage C mais cela compilait magiquement avec GCC. Cependant, consciencieux comme nous sommes, nous avons pris le soin d'éliminer la vingtaine de fonctions imbriquées que nous utilisions en ajoutant simplement quelques paramètres à nos fonctions de traitement.

\section{Implémentation de nouvelles commandes}

\subsection{La commande PRIVMSG}

La commande PRIVMSG est utilisée lorsque un utilisateur désire s'adresser à un ou plusieurs utilisateurs du réseaux, mais également à un ou plusieurs canaux.

\subsection{La commande LIST}

La commande LIST est utilisée pour récupérer la liste des canaux visibles sur le serveur. Pour chaque canal, on reçoit plusieurs informations : le nom du canal, le nombre d'utilisateurs présents et le sujet de discussion relatif au canal.

\subsection{La commande TOPIC}

La commande TOPIC permet de récupérer ou de modifier le sujet de discussion d'un canal, il s'agit d'une phrase qui sert à définir l'intérêt du canal. En mode lecture, on reçoit également le pseudonyme de l'auteur du topic actuel ainsi que la date à laquelle il a été établi.

\subsection{La commande KICK}

La commande KICK est employée pour exclure un utilisateur d'un canal. On peut spécifier un motif d'expulsion pour justifier l'utilisation de la commande. Elle se révèle très pratique pour sanctionner le flood ou les propos calomnieux.

\subsection{La commande NAMES}

La commande NAMES sert à récupérer la liste des utilisateurs d'un canal, ainsi que leur mode sur ce canal, c'est-à-dire s'ils ont des privilèges \textit{opérateur} ou \textit{voice}.

\subsection{La commande WHO}

La commande WHO sert à afficher des informations détaillées sur un utilisateur en particulier ou bien sur tous les utilisateurs d'un canal.

\subsection{La commande MODE}

La commande MODE sert à consulter et définir les modes des canaux et des utilisateurs.

\subsubsection{Les modes des utilisateurs}

Les modes des utilisateurs permettent de les caractériser dans certains traitements de messages. Ainsi le mode +i active l'invisibilité pour certaines commandes de recherche d'utilisateurs. le mode +o global identifie les IRCops (les administrateurs du serveur) et ne peut être modifié par l'utilisateur, il est défini par le serveur à la suite d'une authentification réussie avec la commande OPER. Un utilisateur avec le mode +w (wallop) activé recevra les messages de notification de l'état du réseau.

\subsubsection{Les modes des canaux}

Les modes des canaux permettent principalement de définir des restrictions. Le mode +t permet de restreindre la modification du topic aux opérateurs du canal. Le mode +n désactive les messages externes, c'est-à-dire ceux émanant d'utilisateurs étrangers au canal. Le mode +m restreint la parole aux \textit{opérateurs} et \textit{voices}. Le mode +l définit le nombre maximal d'utilisateurs sur un canal. Le mode +k permet de définir un mot de passe pour le canal. Le mode +s rend le canal secret. Le mode +i le rend accessible sur invitation uniquement.

\subsubsection{Les modes des utilisateurs sur les canaux}

Le mode +b permet d'ajouter un masque de bannissement à la liste du canal pour interdire l'accès aux utilisateurs filtrés par ce masque. Les modes +o et +v permettent d'accorder des privilèges aux utilisateurs.

\section{Gestion des erreurs}

La RFC 1459 définit un certain nombres de messages d'erreurs permettant ainsi au serveur de gérer ces dernières de manière ordonné et efficace.
Chaque réponse est présentée avec son numéro, son nom, et sa chaîne de réponse (en anglais). Par exemple, si un message est envoyé à un utilisateur inexistant,
la réponse d'erreur sera : 401 ERR\_NOSUCHNICK "<pseudonyme> :No such nick/channel". 

\section{Fichier de configuration}

Dans le but de fournir une application graphique de paramétrage du serveur, nous avons mis en place un fichier d'initialisation 
des longueurs maximum des chaines de caractères telles que le nom du serveur, le \emph{nick} de l'utilisateur\ldots, ainsi que 
des valeurs numériques comme le port d'écoute. A l'avenir, ce fichier sera généré automatiquement au démarrage du serveur.

